---
layout: post
title:  "[안드로이드] 🗒 Fragment의 디자인 철학과 라이프 사이클을 알아보자!"
date:   2020-09-16 18:34:10 +0700
categories: [안드로이드]
---

# [🗒 Fragment의 디자인 철학과 라이프 사이클을 알아보자!]

안드로이드 앱 개발을 하면서 Fragment를 많이 사용하지만 아직 제대로 Fragment에 대해 공부를 해본 적이 없었다. 조금 더 안드로이드 플랫폼에 대해 이해를 한 상태에서 개발을 하고 싶어 Fragment에 대해 공부해보기로 했다!

[Android Developer - Fragment 개요](https://developer.android.com/guide/components/fragments) 문서를 읽어보자.

## 1️⃣ Fragment는 언제 처음 Android 플랫폼에 등장했고 왜 등장했을까?

Android가 프래그먼트라는 것을 처음 도입한 것은 Android 3.0(API 레벨 11)부터 였다. Android 3.0은 허니콤이라는 이름으로 출시된 안드로이드 버전이고 2011년에 출시되었다.

즉, 프래그먼트는 2011년부터 등장하여 꾸준히 업그레이드 된 녀석이다.

처음 프래그먼트가 Android 플랫폼에 도입된 이유는 태블릿과 같은 큰 화면에서 보다 역동적이고 유연한 UI 디자인을 지원하기 위해서였다.

예를 들어, 기본 모바일 화면보다 화면 크기가 큰 태블릿에서 뉴스 앱을 실행시킨다고 가정해보자. 또 이 뉴스 앱은 프래그먼트를 사용한다고 가정해보자.

이 경우에 뉴스 앱은 하나의 프래그먼트를 사용하여 왼쪽에는 기사의 목록을 보여줄 수 있고 오른쪽에는 기사 내용을 보여줄 수 있다.

이 두 프래그먼트 모두 하나의 액티비티 위에서 양쪽으로 나란히 배치되어 나타나며 각 프래그먼트는 자신만의 생명 주기를 가지고 있다. 따라서 각자의 생명 주기 콜백 메소드를 사용하여 사용자 이벤트를 왼쪽 프래그먼트 따로 오른쪽 프래그먼트 따로 처리할 수 있다.

프래그먼트를 사용하지 않았다면 기사의 목록을 보는데 액티비티 하나를 사용하고 선택한 기사의 내용을 보는데 또 다른 액티비티를 사용하여 봐야했을 것이지만 프래그먼트를 사용함으로써 단 하나의 액티비티에서 두 가지 일을 한 번에 처리할 수 있게 된 것이다.

<img width="581" alt="02" src="https://user-images.githubusercontent.com/31889335/93320234-c932b280-f84b-11ea-9de9-4cda4288739a.png">

## 2️⃣ Fragment를 사용할 때 지켜야하는 디자인 철학이 있다?

1. __각 프래그먼트는 모듈식으로 생각해야 하고 따라서 재사용 가능한 화면을 구현할 때 사용해야 한다.__

    프래그먼트는 자체적인 생명 주기를 가지고 있고, 그 안에 자체적인 동작을 구현하기 때문에 서로 다른 액티비티에 올라가도 재사용이 가능하다.

    따라서 다른 액티비티에서도 다시 사용할 것을 염두해 두고 프래그먼트를 디자인하는 것이 좋다.

2. __하나의 프래그먼트를 다른 프래그먼트에서 직접 조작하는 것을 삼가야 한다.__

    하나의 프래그먼트를 다른 프래그먼트에서 직접 조작하지 말라는 의미는 각 프래그먼트는 각각 독립적인 모듈이라는 의미이다.

    프래그먼트는 독립적인 모듈이기 때문에 다음과 같은 상황에 대처할 수 있게 된다.

    예를 들어, 태블릿에서 작동하는 뉴스앱과 일반 모바일 핸드폰에서 작동하는 뉴스앱이 있다고 가정해보자.

    태블릿에서 작동하는 뉴스앱은 위에서 한 번 보았던 화면과 같다.

    <img width="581" alt="02" src="https://user-images.githubusercontent.com/31889335/93320234-c932b280-f84b-11ea-9de9-4cda4288739a.png">

    이렇게 Activity A 라는 하나의 액티비티 안에 기사 목록을 보여주는 프래그먼트와 기사 내용을 보여주는 프래그먼트를 나란히 배치하였다.

    반면 일반 모바일 핸드폰에서 뉴스앱이 작동한다면 화면이 어떻게 구현될까?

    일반 모바일 핸드폰은 태블릿보다 화면 크기가 작기 때문에 하나의 액티비티 안에 기사의 목록도 보여주고, 기사 내용도 보여주는 것은 너무 투머치일 것이다.

    따라서 일반 모바일 핸드폰 뉴스앱에서는 아래와 같이 UI를 구성할 것이다.

    <img width="330" alt="03" src="https://user-images.githubusercontent.com/31889335/93443580-4bce7700-f90b-11ea-9bc4-a567536b3a8f.png">

    Activity A 라는 액티비티에 뉴스 목록을 보여주는 프래그먼트를 배치하고, 또 다른 액티비티인 Activity B 라는 액티비티에 뉴스 내용을 보여주는 프래그먼트를 배치할 것이다.

    따라서 Activity A 에서 뉴스 목록을 통해 하나의 뉴스를 클릭하면 Activity B 로 전환되어 해당 뉴스의 내용을 볼 수 있을 것이다.

    즉, 하나의 앱이 디바이스에 따라 UI가 다르게 구성될 수 있기 때문에 프래그먼트는 서로 독립적이여야 한다.

## 3️⃣ Fragment만의 생명주기!

위에서 언급한 것처럼 프래그먼트는 자신만의 생명주기를 가지고 있다. Activity의 생명주기와 비슷한 주기들도 있어서 잘 구분할 수 있어야 한다.

__프래그먼트가 올려져 있는 액티비티가 실행 중일 때__ 프래그먼트의 생명 주기는 다음 그림과 같다!

<img width="271" alt="04" src="https://user-images.githubusercontent.com/31889335/93446835-a3211700-f90c-11ea-872f-2a95f0aad121.png">

실제로 프래그먼트를 구현할 때는 위에서 보이는 모든 주기에 대한 콜백 메소드를 구현할 필요는 없지만 최소한 __onCreate()__, __onCreateView()__, __onPause()__ 콜백 메소드는 구현해야 한다.

1. __onCreate()__

    이 콜백 메소드는 프래그먼트가 생성될 때 시스템에서 호출하는 메소드이다.

    프래그먼트가 생성되어 onCreate() 콜백 메소드가 호출되는 순간들은 __처음 프래그먼트가 생성될 때__, __프래그먼트가 일시 정지 되었다가 재개될 때__, __프래그먼트가 중단 되었다가 재개될 때__ 이다.

    따라서 onCreate() 콜백 메소드는 프래그먼트를 구성하는 요소 중 프래그먼트가 일시 정지되거나 중단 되었다가 다시 재개되었을 때 유지되어야 하는 것들을 초기화시켜주는 용도로 사용된다.

2. __onCreateView()__

    이 콜백 메소드는 해당 프래그먼트가 자신의 UI를 처음으로 그릴 시간이 되면 시스템에서 호출하는 메소드이다.

    따라서 이 메소드의 반환값은 자신의 UI를 담은 View 객체이다. 만약 해당 프래그먼트에서 UI를 제공하지 않는 경우 null 을 반환하면 된다.

3. __onPause()__

    이 콜백 메소드는 사용자가 해당 프래그먼트는 떠났을 때 시스템에서 호출하는 메소드이다.

    다만 사용자가 프래그먼트를 떠났다는 것의 의미는 프래그먼트가 소멸(destroy)되었다는 것이 아니고, 다른 액티비티가 가장 앞에 있어 포커스를 가지고 있지만 이 프래그먼트를 가지고 있는 액티비티도 여전히 표시되고 있는 상태를 의미한다.

    예를 들어, 가장 앞에서 포커스 되고 있는 액티비티가 투명한 색을 가지고 있거나 화면의 전체를 덮지 않고 있어 해당 프래그먼트를 가지고 있는 액티비티가 뒤에 보이는 경우 onPause() 콜백 메소드가 호출된다.

    따라서 '일시정지' 상태라고 생각하면 된다.

    onPause인 경우에는 두 가지 가능성이 있다. 사용자가 해당 프래그먼트를 잠깐 떠났다가 다시 되돌아 올 수도 있고, 아예 돌아오지 않을 수도 있다.

    따라서 onPause() 콜백 메소드에서는 현재 사용자가 세션을 넘어서도 지속되어야 하는 값들을 저장하거나 커밋해주는 코드를 구현해야 한다. 왜냐하면 사용자가 아예 돌아오지 않을 가능성도 있기 때문이다.

이렇게 프래그먼트를 구현할 때 최소한으로 구현해야 하는 콜백 메소드들을 알아보았다.

그렇다면 이제 프래그먼트 수명 주기에 포함되는 다른 메소드들의 역할도 알아보자!

먼저 프래그먼트 수명 주기에 포함된 메소드들은 __프래그먼트의 수명 주기에 직접적으로 해당되는 것들__ 과 __액티비티 수명 주기와 프래그먼트 수명 주기의 조화를 담당하는 것들__ 로 분류될 수 있다.

먼저 프래그먼트의 수명 주기에 직접적으로 해당되는 메소드들에 대해 알아보자.

1. __onResumed()__

    이 메소드는 프래그먼트가 화면에 보여지는 단계 즉, 사용자와 프래그먼트가 상호 작용할 수 있는 단계가 되면 시스템에서 호출하는 메소드이다.

2. __onPause()__

    이 메소드는 위에서 설명했으므로 따로 설명하지 않는다.

3. __onStop()__

    이 메소드는 '일시 정지'를 나타내는 onPause()와는 조금 다른 온전히 '정지'를 의미한다.

    따라서 사용자가 해당 프래그먼트를 온전히 보지 못할 때 시스템에서 호출하는 메소드이다.

    다른 액티비티로 전환됨으로써 해당 프래그먼트를 가지고 있는 액티비티가 정지되어 사용자의 눈에 해당 프래그먼트가 더이상 보이지 않을 때를 말한다.

다음으로 액티비티 수명 주기와 프래그먼트 수명 주기의 조화를 담당하는 것들에 해당되는 메소드들에 대해 알아보자.




