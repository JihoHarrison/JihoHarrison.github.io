---
layout: post
title:  "[OS] 운영체제4"
date:   2019-04-13 18:34:10 +0700
categories: [operating system]
---


> 서울과학기술대학교 3학년 교과과정으로 배운 "운영체제" 시험 공부 및 정리용 포스팅 😆
>
> _4강 - Threads_
>
> 🙋 4강에서 설명할 수 있어야 할 것들 🙋
> 
> - 프로세스의 문제점
> - 쓰레드란?
> - 싱글쓰레드와 멀티쓰레드

<br>

## 💁 What is 쓰레드?
---

- _프로세스의 문제점_

	프로세스가 생성되면 각 프로세스마다 자신만의 주소 공간이 생기는데 만약 실행되고 있는 프로그램이 너무 많아서 주소 공간이 많아지게 되면 메모리적으로 문제가 된다.

	또 메모리 뿐만 아니라 주소 공간을 만들때마다 타임딜레이(time-delay)가 생겨서 공간적, 시간적인 문제가 발생할 수 있다.

	<br>

- _웹 서버_

	> 갑자기 이 흐름에서 웹 서버가 왜 나오지?

	웹 서버도 웹 페이지를 전달하는 프로그램이다!

	![운영체제17](https://user-images.githubusercontent.com/31889335/56079775-c4d2c080-5e33-11e9-8f6f-37dc0795d0e2.PNG)

	위 그림에서 볼 수 있듯이 웹 서버도 CPU 할당을 받아 실행되는 프로그램이다.

	즉, 웹 서버가 작동하면 프로세스가 생성되는 것이다.

	웹 서버는 많은 사람들에게 같은 시간동안 많은 요청과 응답 서비스를 제공해야 한다.

	만약 웹 서버가 한 번에 한 명의 요청에만 응답한다면 어떻게 될까?

	다른 클라이언트의 요청을 동시에 처리할 수 없게 된다!

	즉, 웹 서버 프로세스는 동시적으로 발생하는 서비스들을 잘 처리할 수 있어야 한다.

	또한 유저는 하나의 웹 서버만을 사용하는 것이 아니라 여러 웹 서버를 동시에 사용한다.

	웹 서버 프로세스는 자신의 리소스(CPU 등)를 가지고 있다. 하지만 실행되는 웹 서버 프로세스가 많아질수록 그에 비례하여 필요로 하는 리소스도 많아진다.

	즉, 컴퓨터 입장에서는 메모리에 부담이 발생하고 이에 따라 프로세스를 생성하는데 타임 딜레이가 발생한다.

	또, 웹 서버를 쓰레드로 실행시키면 한 쓰레드를 통해 클라이언트의 다른 요청에 응답할 수 있고, 동시에 다른 쓰레드를 통해 파일을 다운 받는 프로그램을 실행시킬 수 있다.

	<br>

- _쓰레드를 사용하자!_

	__쓰레드(Thread)__ 라는 것은 프로세스와 텍스트(코드), 데이터, 리소스, 힙 등을 공유하는 존재이다. (하지만 스택, 레지스터, 쓰레드ID는 공유하지 못함)

	따라서 쓰레드를 생성할 때 주소공간의 텍스트, 데이터, 리소스, 힙 공간을 새로 생성할 필요가 없다. 공유되기 때문이다.

	이 모든 것을 각각 따로 만드는 프로세스보다 쓰레드가 메모리 부분에서 훨씬 가볍다. 또 쓰레드를 생성하는 시간도 적게 걸린다.

	이런 이유로 웹 서버를 프로세스로 하지 않고, 쓰레드로 한다면 많은 부분에서 이득을 볼 수 있다.

	즉, 기존에는 새로운 프로그램이 실행된다는 것은 새로운 프로세스가 생성된다는 것이였다. 

	하지만 프로세스 대신 쓰레드를 사용하는 시스템에서는 새로운 프로그램이 실행된다는 것을 새로운 쓰레드가 생성된다는 것으로 바뀌는 것이다.

	<br>

## ❓❗ 그래서 쓰레드의 '정의'는 뭐야?
---

- _Thread_

	쓰레드는 CPU 사용률의 기본적인 단위이다. 그리고 각각의 프로세스는 많은 쓰레드를 포함할 수 있다. 즉, 프로세스 안에 여러 개의 쓰레드가 있을 수 있다.

	<br>

- _쓰레드가 프로세스와 공유하는 것들_

	프로그램의 코드, 데이터, 힙, signal handler, 현재 디렉토리, user ID, 파일 열기 등등

	<br>

- _쓰레드 자신만이 갖는 것들_

	스택, 레지스터, 쓰레드 ID

	<br>

## 👪 싱글쓰레드와 멀티쓰레드
---

- _말 그대로!_

	싱글 쓰레드는 한 프로세스가 쓰레드를 하나 포함하고 있는 것이고, 멀티 쓰레드는 한 프로세스가 여러개의 쓰레드를 포함하고 있는 것이다.

	![운영체제18](https://user-images.githubusercontent.com/31889335/56079936-006e8a00-5e36-11e9-8d37-eb9b1972034b.PNG)

	위 그림에서 싱글 쓰레드를 가진 프로세스와 멀티 쓰레드를 가진 프로세스의 모습을 볼 수 있다.

	멀티 쓰레드를 가진 프로세스를 보면 코드, 데이터, 파일 부분을 공유하고 각각 서로 다른 레지스터와 스택을 갖는 모습을 볼 수 있다.

	<br>

## 💥 쓰레드 vs 프로세스
---

- _fork를 통해 새로운 프로세스를 생성하는 것은 메모리와 시간 비용이 많이 든다._

	하지만 상대적으로 쓰레드는 많은 메모리나 시간을 요구하지 않는다. 왜냐하면 기존 프로세스와 공유하는 부분이 많기 때문이다.

	하지만 쓰레드가 메모리와 시간 비용이 전혀 들지 않는다는 것은 절대 아니다!

	<br>

- _프로세스를 생성하는 함수와 쓰레드를 생성하는 함수의 차이점_

	새로운 프로세스는 fork를 통해 만들어지지만 새로운 쓰레드는 __pthread_create()__ 라는 함수를 통해 만들어진다. 

	![운영체제19](https://user-images.githubusercontent.com/31889335/56080024-c5208b00-5e36-11e9-8609-ba794fbbe814.PNG)

	위 그림에서 pthread_create()로 생성된 쓰레드는 Stack부분만 새로 생성되는 모습을 볼 수 있다.

<br>

- _경제적 차이_

	쓰레드는 프로세스에 비해 context switching을 할 때 걸리는 시간이 짧다.

	<br>

- _MP 아키텍쳐(구조)에서 유용하다_

	__MP 아키텍쳐__ = Multi Process 아키텍쳐(즉, 많은 프로세스들이 병렬적으로 실행되는 구조)

	<br>

## 〰️ 리눅스의 쓰레드
---

- _리눅스에서 쓰레드를 생성하는 방법_

	__clone()__ 이라는 시스템 콜을 통해 쓰레드를 생성한다.

	리눅스는 프로세스와 쓰레드를 구별하지 않는다.

	clone() 시스템 콜의 첫번째 인자에는 flag라는 것이 들어간다. flag는 생성될 쓰레드는 부모 쓰레드와 자식 쓰레드 간에 얼만큼의 자원 공유를 할 것인지를 정해준다.

	![운영체제34](https://user-images.githubusercontent.com/31889335/56294918-db945280-6166-11e9-8fce-425afd6b3c1d.PNG)
