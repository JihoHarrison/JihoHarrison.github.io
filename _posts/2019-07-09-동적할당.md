---
layout: post
title:  "[C] 🎭 드디어 동적할당!"
date:   2019-07-09 18:34:10 +0700
categories: [c]
---

> [참고 자료](https://modoocode.com/98) <-- 공부에 참고한 사이트
>
> VLA에 대해서 알게된 후, 이제부터는 동적할당을 공부하고 알고리즘 코드 작성에 써먹어야지 했던 걸.. 이제서야 공부한다😅
>
> --> [VLA에 대한 포스팅 ㄱㄱ](https://choheeis.github.io/algorithm/2019/05/09/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%95%8C%EA%B2%8C%EB%90%9C%EA%B2%83-1.html)

<br>

## ❓ 동.적.할.당 어디서 나온 개념인가?
---

- _동적할당의 시초_

	동적할당을 모르는 사람들에게 배열을 생성하라고 한다면 이 사람들은 배열의 크기를 상수로 잡을 것이다. 

	즉, 배열의 크기를 컴파일러가 추측할 필요없이 명확하게 나타낼 것이다.

	하지만 이 사람들은 한가지 고민을 하게 될 것이다! 
	
	만약 배열의 크기가 매번 변동되어야 하는 프로그램을 작성해야 한다면 '충분히 크게' 배열의 크기를 잡을 것이고, 이 경우에는 메모리 낭비가 발생하게 됨을 고민하게 될 것이다.

	이런 문제점을 해결할 수 있는 방법이 바로 __동적할당__ 이다.

	> 사실 동적할당보다는 __동적 메모리 할당__ 이라는 이름이 더 정확하다.
	>
	> __동적__ = '가변적으로 변할 수 있음' 이라는 뜻

	__동적할당은 말 그대로 메모리를 동적으로 할당한다는 것이다!__

	<br>

## 🙀 c언어에서 동적할당을 사용하는 방법
---

- _c언어에서 동적할당을 사용하는 방법_

	위에서 알게 된 동적할당을 통해 배열 크기를 가변적으로 잡고 싶다면 c언어에서 어떻게 코드를 짜야할까?

	__c언어 라이브러리 중 \<stdlib.h> 라는 헤더파일에 들어있는 malloc 라는 함수를 사용하면 된다!__

	> 💁 \<stdlib.h> 헤더파일이 뭘까?
	>
	> standard library 의 약자로, c언어 표준 라이브러리이다. 이 헤더파일에는 문자열 변환, 난수(랜덤수) 생성, 동적 메모리 관리 등의 함수가 포함된다.
	>
	> --> [참고](https://ko.wikipedia.org/wiki/Stdlib.h)

	<br>

	> 💁 malloc 함수는 뭘까?
	>
	> malloc 함수는 memory allocation(=메모리할당)의 약자를 이름으로 갖는 stdlib.h 헤더파일에 속한 동적 메모리 관련 함수이다. 
	>
	> 이 함수는 인자로 전달된 크기의 바이트 수 만큼의 메모리 공간을 만든다. 
	>
	> 또, 생성한 메모리의 시작 주소를 리턴해준다. 
	>
	> --> [참고](https://ko.wikipedia.org/wiki/Stdlib.h)를 보면 malloc 함수의 원형을 확인할 수 있다.

	<br>

	따라서 아래와 같은 c코드로 프로그램을 실행시킬 떄마다 크기가 다른 배열을 생성할 수 있다!

	~~~c
	#include<stdio.h>
	#include<stdlib.h>

	int main(){
		// 배열 크기 입력 
		int n; 
		scanf("%d", &n);
		
		
		int *arr;
		// 인자에는 할당할 메모리 크기를 바이트 단위로 써준다.
		// 반환값은 malloc 함수가 할당한 메모리의 시작 주소이다. 
		// sizeof() 함수를 통해 int형 자료형의 메모리 크기를 알아낸다.
		// 함수 원형을 보면 malloc함수는 void* 형으로 반환하므로 (int *)으로 형변환하여 arr에 넣어준다. 
		arr = (int *)malloc(sizeof(int) * n);

		int input;
		for(int i = 0 ; i < n ; i++){
			scanf("%d", &input);
			arr[i] = input;
		}
		// 할당받은 메모리 영역을 다 사용한 후에 다시 컴퓨터에게 돌려주는 역할
		// free를 해주지 않으면 더이상 사용하지 않는 메모리가 자리만 차지하게 된다. = 메모리 누수 
		free(arr);
	}
	~~~

	<br>

## 🎰 malloc함수는 메모리를 어디에 할당할까?
---

- _어디일까? 스택?? 힙?_

	여기서 추가로 알게되는 것이 있는데 __스택 영역은 반드시 컴파일 때에 100%로 크기가 불변하는 메모리가 할당되는 공간__ 이라는 것이다!

	> 지역변수가 스택영역에 할당되는 이유이다. 

	따라서 프로그램이 실행될 때마다 할당되는 메모리의 크기가 가변적인 동적할당은 __힙(Heap) 영역__ 에 할당된다.

	> 프로그램이 실행될 때 생성되는 힙 영역은 크기가 자유자재로 변할 수 있는 공간이다.

	하지만 힙영역을 사용할 때 꼭 주의해야 하는 것이 있다!

	위 코드에서 free()함수를 통해 메모리를 돌려준 것처럼 __힙 영역에 할당한 메모리는 사용 후에 반드시 해제시켜줘야 한다.__