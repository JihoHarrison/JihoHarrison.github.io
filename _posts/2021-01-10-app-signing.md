---
layout: post
title:  "[안드로이드] Android 앱 서명하기(App Signing)"
date:   2021-01-10 18:34:10 +0700
categories: [안드로이드]
---

> __참고 레퍼런스__
>
> ✍🏻 [Android Developer 도큐먼트 - 앱 서명](https://developer.android.com/studio/publish/app-signing)
>
> ✍🏻 [Google Play Console 고객 센터 - 앱 서명하기](https://support.google.com/googleplay/android-developer/answer/9842756?hl=ko)
>
> ✍🏻 [리노의 로켓박스 - 공개키 인증서](https://blog.naver.com/nttkak/20130244771)


## 0️⃣ 앱 서명에 대해 알아보기 전, 먼저 알아야 하는 개념 및 정의들

* 앱 서명이 무엇인지 알아보기 전, __인증서(Certificate)__, __키(Key)__, __키 저장소(Key Store)__ 라는 개념에 대해 이해해야 한다.

* __인증서(Certificate) = 공개키 인증서__ 

    * 보통 Android 앱 서명에 사용되는 '인증서' 라는 용어는 사실 __공개키 인증서(Public-key Certificate)__ 라고 부르고, __디지털 인증서__, __ID 인증서__ 라고도 부른다.

    * 사람이 보유하고 있는 인증서들

        * 주민등록증 : 이 인증서를 소유하고 있는 사람이 대한민국 주민임을 증명하는 문서

        * 학생증 : 이 인증서를 소유하고 있는 사람이 해당 학교에 재학하는 학생임을 증명하는 문서

        * 운전면허증 : 이 인증서를 소유하고 있는 사람이 운전 면허 시험을 통과한 사람임을 증명하는 문서

        * __결론 )__ 인증서는 해당 인증서를 보유하고 있는 소유자의 신원을 증명하는 문서이다.

    * 운전면허증에 포함되어 있는 정보들

        * 인증서 명 : 자동차 운전 면허증

        * 면허 종류 : 2종 보통

        * 소유자 성명 : 홍길동

        * 소유자 주민 번호 : 000000-000000

        * 소유자 주소 : 서울시 OO구 OO동 OO호

        * 발급 날자 : 2021.01.01

        * 발급 자/발급 기관 : 서울 지방 경찰청장

        * 발급자 도장 : 도장 or 홀로그램

        * 소유자 서명 : 필체 서명

        * <img width="300" alt="01" src="https://user-images.githubusercontent.com/31889335/104124623-2fac8500-5395-11eb-98d0-15b9c718b1fa.png">

    * __공개키 인증서란?__

        * 위 예시들을 토대로 공개키 인증서에 대해 이해해보자.

        * <img width="572" alt="02" src="https://user-images.githubusercontent.com/31889335/104124748-c37e5100-5395-11eb-83a1-2db37d883b45.png">

        * 공개키 인증서는 운전면허증처럼 물리적인 문서가 아닌 디지털 문서이지만 이해하기 쉽게 시각화를 해본다면 위 그림과 같을 것이다!

        * 공개키 인증서에 포함되어 있는 '서명'은 소유자의 서명이 아닌 인증서를 발급한 자의 전자 서명이다.(16진수로 나타냄)

        * 공개키 인증서에 포함되어 있는 '공개키'는 보안 관련된 암호 방식의 일종인 공개키/비공개키 쌍 중 공개키이다.

        * 공개키 인증서는 말 그대로 공개키를 인증하기 위한 문서이고, 실제로는 확장자가 .der 또는 .pem인 파일이다.

        * '공개키를 인증한다'는 것은 공개키 인증서에 포함되어 있는 공개키와 해당 공개키의 키쌍에 맞는 비공개키가 일치함을 증명하는 것이다.
        
        * 따라서 공개키/비공개키의 쌍이 일치한다는 것은 해당 비공개키를 소유하고 있는 사람이 공개키의 주인임을 증명하는 것이 된다.

        * 이러한 방식으로 공개키 인증서는 비공개키를 소유하고 있는 사람의 신원을 증명하는 역할을 한다.

    * __인증서가 사용되는 과정__
    
        * 앱을 출시하기 위해서는 개발자가 앱에 서명을 해야 한다.(아래 내용에서 자세히 설명 예정) 

        * 앱에 서명한다는 것은 개발자가 공개키/비공개키 쌍을 만든다는 것이다. 
        
        * 더 정확히는 개발자가 비공개키를 생성하면 해당 비공개키로 복호화할 수 있는 암호화된  공개키가 생긴다.(공개키/비공개키 쌍 생성됨)
        
        * 공개키는 공개키 인증서에 포함되고, 비공개키는 개발자 자신이 소유한다.

        * 개발자가 키쌍을 생성하면 Signing Tool(서명 도구)이 공개키 인증서를 앱에 첨부한다.
        
        * 추후에 해당 앱을 개발한 사람이 자신임을 증명해야 할 경우, 앱에 첨부되어 있는 공개키 인증서에 존재하는 공개키와 개발자가 소유하고 있는 비공개키 쌍이 맞음을 증명하면 된다.

        * 이렇게 앱에 서명하는 과정에서 생성된 __비공개키__ 를 __앱 서명 키(App Signing Key)__ 라고 한다.

    * __인증서가 필요한 이유__

        * Android 시스템은 처음 앱에 서명한 사람과 앱을 업데이트한 사람이 동일한 인물일 경우에만 새 버전을 업로드할 수 있는 보안 시스템을 가지고 있다.

        * 따라서 Android 시스템은 앱을 처음 출시할 때 첨부된 공개키 인증서를 통해 개발자가 제시하는 비공개키와 해당 공개키 쌍이 맞는 쌍인지 확인함으로써 개발자 신원을 증명하게 된다.
        
* __키(Key)__

    * Android 앱 출시 과정에서 사용되는 '키' 라는 용어는 공개키/비공개키 에서 비롯된 용어이다.

    * 키는 2가지 종류가 있는데 __앱 서명 키__ 와 __업로드 키__ 라는 것이 있다.

        * __앱 서명 키__ : 앱을 출시하기 위해 '앱 서명'이라는 것을 진행해야 하는데, 이 때 사용되는 비공개키를 앱 서명 키라고 한다.

            사용자가 앱 설치 요청을 하면 Google Play는 사용자에게 앱을 제공하기 전, 앱 출시 시 사용한 앱 서명 키로 다시 한 번 앱에 서명하여 제공한다.

            따라서 사용자의 기기에 설치되려는 앱에 서명할 때도 앱 서명 키가 사용된다.

            앱 서명 키는 앱을 한 번 출시한 후에는 절대로 변하지 않으며, 외부에 공개되어서도 안된다.

            하지만 앱 서명 키를 사용하여 생성한 공개키 인증서는 외부에 공유할 수 있다.

        * __업로드 키__ : Google Play의 Dynamic Delievery 라는 새로운 앱 제공 모델이 등장하면서 같이 등장한 새로운 키이다.

            기존에는 앱 출시 시 앱에 서명할 때 사용되는 키를 앱 서명 키라고 불렀지만, 새로운 앱 제공 모델에서는 앱 출시를 위해 앱에 서명할 때 사용되는 키를 __업로드 키__ 라고 부르기로 했다.

            업로드 키도 반드시 비공개로 유지해야 하지만 업로드 키를 사용하여 생성한 공개키 인증서는 외부에 공유할 수 있다.

* __키 저장소(Key Store)__

    * 인증서와 비공개키를 저장하고 있는 저장소이다.

    * 이 저장소는 바이너리 파일 형태로 존재한다.

    * 이 바이너리 파일의 확장자는 .jks 또는 .keystore 이다.

## 1️⃣ What is 앱 서명(App Signing)?

* 앱 서명은 개발자가 앱을 출시하기 위해 따라야하는 프로세스 단계 중 하나이다.

* 앱 서명은 '이 앱을 개발한 사람이 나야! 내가 이 앱의 주인이야!' 임을 증명하기 위해 사용된다.

* 앱에 서명한다 = APK나 App Bundle에 서명한다.

* 먼저 알아본 인증서, 키, 키 저장소에 관한 이해를 했다면 앱 서명이 무엇인지 자연스럽게 깨닫게 될 것이다.

## 2️⃣ 앱에 서명하는 방법

* 2018 Google I/O에서는 Google Play에 앱을 업로드하기 위한 새로운 방법으로 Dynamic Delivery라는 모델을 제시했다.

* 이 모델이 등장하면서 앱 서명 방식에도 변화가 생겼는데, 이 포스팅에서는 바뀐 서명 방식(업로드 키로 서명하는 방식)에 대해 설명할 것이다.

* __Dynamic Delivery 등장 이후 앱에 서명하는 과정__

    * 기존에는 앱 서명 키로 앱에 서명했지만 Dynamic Delivery 등장 이후에는 업로드 키라는 것으로 앱에 서명해야 한다.

    1. __업로드 키__ 생성하기

        * Android Studio 메뉴 바 > Build > Generate Signed Bundle/APK 클릭

        * <img width="250" alt="03" src="https://user-images.githubusercontent.com/31889335/104127651-b6b62900-53a6-11eb-8df5-417bf329b166.png">

        * Android App Bundle 또는 APK를 선택

        * <img width="601" alt="04" src="https://user-images.githubusercontent.com/31889335/104127682-e107e680-53a6-11eb-8e8e-020218cdc25b.png">

        * Key store path 박스 아래의 Create new 클릭

        * <img width="819" alt="05" src="https://user-images.githubusercontent.com/31889335/104127778-5d022e80-53a7-11eb-9cea-44a56b60cf64.png">

        * New Key Store 창에서 키 저장소 정보와 키 정보를 입력

        * <img width="538" alt="06" src="https://user-images.githubusercontent.com/31889335/104128083-dea68c00-53a8-11eb-94f0-3cc642df1487.png">

            * __Key store path__ : 키 저장소(바이너리 파일)을 생성할 위치 설정

            * __Password__ : 키 저장소에 사용할 비밀번호

            * __Key Alias__ : 키를 식별할 수 있는 이름

            * __Key Password__ : 키에 사용할 비밀번호(키 저장소 비밀번호와 달라야 함)

            * __Validity(years)__ : 키가 유효하게 유지되는 기간 설정(키 유효기간이 최소 25년 이상 설정되어야 앱이 세상에 존재하는 기간 동안 이 키로 앱에 서명할 수 있다)

            * __Certificate__ : 공개키 인증서에 포함될 정보들(개발자 자신을 나타내는 정보)

        * 여기까지 하면 키 생성 완료이다! 만약 키 생성만 하려면 Cancel을 클릭하고, 생성한 키로 앱을 빌드하고 서명하는 작업까지 이어서 하려면 Next를 클릭

        * <img width="799" alt="07" src="https://user-images.githubusercontent.com/31889335/104128307-3691c280-53aa-11eb-87dd-e0844154bbe6.png">

        * 설정한 키 저장소 경로에 가보면 아래와 같이 키 저장소가 생성되어 있음을 확인 가능

        * <img width="746" alt="08" src="https://user-images.githubusercontent.com/31889335/104128387-9ee0a400-53aa-11eb-9be6-d96771ef66a6.png">

    2. __앱에 서명하기__

        * 업로드 키를 생성한 후, 생성한 업로드 키로 앱에 서명을 하면 된다.

        * Android Studio > Bundle > Generate Signed Bundle/APK 클릭

        * 생성한 업로드 키가 저장되어 있는 키 저장소 경로를 선택하고, 키 저장소 비밀번호를 입력한다.

        * <img width="753" alt="09" src="https://user-images.githubusercontent.com/31889335/104129023-16fc9900-53ae-11eb-932a-97aa2bbe3f33.png">

        * 서명된 앱의 대상 폴더를 선택하고, 빌드 타입을 선택한다. (제품 버전이 존재하는 경우 제품 버전도 선택한다.)

        * <img width="760" alt="10" src="https://user-images.githubusercontent.com/31889335/104139615-2997c200-53f0-11eb-961b-c941466af728.png">

        * Finish를 클릭하면 앱이 빌드되고, 서명된 App Bundle이 생성된다.

        * 완료 후 아래와 같은 팝업 창을 통해 서명된 App Bundle이 저장된 위치를 알 수 있고, App Bundle 분석을 할 수 있다.

        * <img width="375" alt="11" src="https://user-images.githubusercontent.com/31889335/104139722-b6db1680-53f0-11eb-9569-a5c60482099f.png">

    3. __이렇게 서명된 APK를 Google Play에 업로드하여 출시하면 된다.__




        


        



> app-build-publish 포스팅에 이 포스팅 링크 걸기
